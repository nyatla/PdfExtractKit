# PdfExtractKit
幾何学的なセレクタでpdfから文字列を読み出すためのツールキットです。
クレジットカードの電子明細PDFを読みだしてCSVにしたりできます。

## セットアップ
```
pip install pdfminer pandas
```

appのextlibsにsubmoduleがあります。

## アプリケーション

### イオンカード電子明細をCSVに変換

```
$ python3 ./app/extractAeoncardPdf.py /mnt/d/tmp.wsl/meisai202009.pdf
('ご利用カード', 'イオンカード') ('今回ご請求金額', 99999) ('お支払日', '2020年9月2日（水）')
:
```

出力
```
ご利用カード	イオンカード
今回ご請求金額	99999
お支払日	2020年9月2日（水）
ご利用明細
20/06/30	本人	ＡＭＡＺＯＮ．ＣＯ．ＪＰ	１回	3333
20/07/11	本人	ＡＭＡＺＯＮ．ＣＯ．ＪＰ	１回	4444
：
20/07/20	本人	ＡＬＩＥＸＰＲＥＳＳ．ＣＯＭ	１回	5555
```

### 楽天カード電子明細をCSVに変換

```
$ python3 ./app/extractRaktenCardPdf.py /mnt/d/tmp.wsl/statement_202101.pdf
('ご利用カード', '楽天カード(VISA)') ('今回ご請求金額', 99999) ('お支払日', '2021年01月ご請求金額')
:
```

明細が複数ページにまたがるpdfは手元にないので対応していません。

### テーブルを含むpdfからデータを抽出してjsonに保存

１ページに１つの（結合などのない）シンプルなテーブルがあると仮定して、その要素を読み出します。

テーブルはRECT要素で構成された表である必要があります。

複数のテーブルを持つページや結合されたセルを持つテーブルからは、正しく要素を取り出せません。

このアプリケーションは、コロナ感染症の副反応資料を読みだすために作成しました。
他のpdfはうまく読みだせないことがあります。
https://www.mhlw.go.jp/stf/shingi/shingi-kousei_284075.html


```
$python3 ../app/tableScraper.py 000830615.pdf --pages 2-
000830615.pdf has 78 pages.
pages: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78]
100%|████████████████████████████████████

```


## ライブラリ

pdfextractkit.pyがpdf読み出し用のライブラリです。
getstarted/getstarted.pyに一通りの昨日を実行するサンプルがあります。
```
$ python3 ./getstarted/getstarted.py
```

pdfparserにはそれぞれのpdfレイアウトに対応した読み出しクラスがあります。
pdfから読みだした情報をpythonオブジェクトに加工します。

